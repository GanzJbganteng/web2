<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Panel Admin Zenix</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url("https://cat.moe/cdn/img/nya.png") center/cover no-repeat fixed;
      color: #fff;
    }
    .screen { display: none; padding: 30px; min-height: 100vh; background: rgba(0,0,0,0.8); }
    .screen.active { display: block; animation: fadeIn 0.4s ease; }
    input, button {
      display: block; width: 100%; margin: 10px 0; padding: 12px;
      border-radius: 8px; border: none; font-size: 1rem;
    }
    button { background: #3b82f6; color: #fff; font-weight: bold; cursor: pointer; }
    .card {
      background: rgba(255,255,255,0.08); backdrop-filter: blur(10px);
      padding: 30px; border-radius: 16px; text-align: center;
      box-shadow: 0 0 12px rgba(0,0,0,0.5); margin-bottom: 20px;
    }
    .card img { width: 80px; height: 80px; margin-bottom: 10px; }
    .grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .logout-btn {
      background: red; position: fixed; top: 20px; right: 20px; z-index: 1000;
    }
  </style>
</head>
<body>

<div class="screen active" id="loginScreen">
  <h2>ğŸ” Login Panel Admin Zenix</h2>
  <input type="text" id="loginUsername" placeholder="Masukkan Username">
  <input type="text" id="loginKey" placeholder="Masukkan KEY Anda">
  <button onclick="login()">ğŸ”“ Login</button>
  <div id="loginStatus"></div>
</div>

<div class="screen" id="mainMenu">
  <h2>ğŸ“‹ Menu Admin</h2>
  <div class="grid">
    <div class="card rp-only" style="display:none;" onclick="showScreen('addTokenScreen')">
      <img src="https://cat.moe/cdn/img/token.png" />
      <div>â• Add Token</div>
    </div>
    <div class="card rp-only" style="display:none;" onclick="showScreen('addKeyScreen')">
      <img src="https://cat.moe/cdn/img/key.png" />
      <div>ğŸ”‘ Add Key</div>
    </div>
    <div class="card dev-only" style="display:none;" onclick="showScreen('updateScreen')">
      <img src="https://cat.moe/cdn/img/update.png" />
      <div>ğŸ†• Update Script</div>
    </div>
    <div class="card dev-only" style="display:none;" onclick="showScreen('addResellerScreen')">
      <img src="https://cat.moe/cdn/img/admin.png" />
      <div>â• Add Reseller</div>
    </div>
    <div class="card dev-only" style="display:none;" onclick="showScreen('addPartnerScreen')">
      <img src="https://cat.moe/cdn/img/partner.png" />
      <div>â• Add Partner</div>
    </div>
  </div>
  <button class="logout-btn" onclick="logout()">ğŸšª Logout</button>
</div>

<!-- Selayar -->
<div class="screen" id="addTokenScreen">
  <button onclick="showScreen('mainMenu')">â† Kembali</button>
  <h2>â• Add Token</h2>
  <input type="text" id="tokenInput" placeholder="Token Telegram">
  <button onclick="addToken()">Tambah Token</button>
</div>

<div class="screen" id="addKeyScreen">
  <button onclick="showScreen('mainMenu')">â† Kembali</button>
  <h2>ğŸ”‘ Add Key</h2>
  <input type="text" id="keyInput" placeholder="KEY">
  <input type="text" id="ownerInput" placeholder="Nama Owner">
  <button onclick="addIdKey()">Tambah Key</button>
</div>

<div class="screen" id="updateScreen">
  <button onclick="showScreen('mainMenu')">â† Kembali</button>
  <h2>ğŸ†• Update Script</h2>
  <input type="text" id="updateUrl" value="https://raw.githubusercontent.com/...">
  <button onclick="autoUpdateScript()">Perbarui Sekarang</button>
</div>

<div class="screen" id="addResellerScreen">
  <button onclick="showScreen('mainMenu')">â† Kembali</button>
  <h2>â• Tambah Reseller</h2>
  <input type="text" id="resName" placeholder="Nama Reseller">
  <input type="text" id="resUser" placeholder="Username">
  <input type="text" id="resKey" placeholder="KEY">
  <button onclick="addRoleUser('reseller')">Tambah Reseller</button>
</div>

<div class="screen" id="addPartnerScreen">
  <button onclick="showScreen('mainMenu')">â† Kembali</button>
  <h2>â• Tambah Partner</h2>
  <input type="text" id="partName" placeholder="Nama Partner">
  <input type="text" id="partUser" placeholder="Username">
  <input type="text" id="partKey" placeholder="KEY">
  <button onclick="addRoleUser('partner')">Tambah Partner</button>
</div>

<script>
const authRepo = "GanzJbganteng/id";
const tokenRepo = "GanzJbganteng/db-zenixx";
const tokenPath = "database.json";

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function logout() {
  sessionStorage.clear();
  location.reload();
}

async function fetchFile(repo, path) {
  const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`);
  if (!res.ok) throw new Error("Gagal akses GitHub");
  const data = await res.json();
  const content = atob(data.content);
  return { json: JSON.parse(content), sha: data.sha };
}

async function login() {
  const username = document.getElementById("loginUsername").value.trim();
  const key = document.getElementById("loginKey").value.trim();
  const status = document.getElementById("loginStatus");

  if (!username || !key) return status.innerText = "âŒ Harap isi semua field.";

  try {
    const file = await fetchFile(authRepo, "auth.json");
    const found = file.json.find(entry => entry.KEY === key && entry.STATUS === "active");

    if (!found) return status.innerText = "âŒ KEY tidak valid atau dibanned.";

    sessionStorage.setItem("login_key", key);
    sessionStorage.setItem("login_username", username);

    document.getElementById("loginScreen").classList.remove("active");
    document.getElementById("mainMenu").classList.add("active");

    document.querySelectorAll(".rp-only").forEach(el => el.style.display = "block");
    if (found.OWNER?.toLowerCase() === "rofik") {
      document.querySelectorAll(".dev-only").forEach(el => el.style.display = "block");
    }

  } catch (e) {
    status.innerText = "âŒ Gagal mengakses database GitHub.";
    console.error(e);
  }
}
</script>

</body>
</html>
